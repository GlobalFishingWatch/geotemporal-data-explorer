(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[207],{13207:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var r=n(26297),a=n(66383),o=n(52322),i=n(5632),u=n(39097),l=n.n(u),c=n(72779),s=n.n(c),d=n(97113),f=n(2784),v=n(18205),m=n(25718),g=n(55484),h=n(25556),p=n(3131),y=n(47857),x=n(63004),E=n(81073),_=n(76635),M=n(99490),b=n(63898),S=n(42055),k=n(34054),C=n.n(k),w=n(23524),Z=function(e){var t=e<1&&e>-1?"~r":"~s";return(0,w.WU)(t)(e)},j=function(e,t,n){var r,a;if(void 0===e||!(null===t||void 0===t?void 0:t.range))return null;var o=null===(r=t.avg)||void 0===r?void 0:r.findIndex((function(t){return t===e})),i=null===(a=t.range)||void 0===a?void 0:a[o],u=i?i[1]-e:0,l=e>0&&u/e*100,c=l?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"!==typeof e?(console.warn("Value not valid be fixed parsed, returning original value",e),e):(Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toFixed(t)}(Math.abs(l),0):"0",s=(0,b.X_)(e,{maximumFractionDigits:2});return"".concat(s," ").concat(n||"")+("0"!==c&&"0"!==s?" \xb1 ".concat(c,"%"):"")},D=function(e){var t=e.active,n=e.payload,r=e.label,a=e.timeChunkInterval;if(t&&n&&n.length){var i=M.ou.fromMillis(r).toUTC().setLocale(S.MV),u="";switch(a){case"month":u=i.toFormat("LLLL y");break;case"10days":var l=i.toLocaleString(M.ou.DATE_MED),c=i.plus({days:9}).toLocaleString(M.ou.DATE_MED);u="".concat(l," - ").concat(c);break;case"day":u=i.toLocaleString(M.ou.DATE_MED);break;default:u=i.toLocaleString(M.ou.DATETIME_MED_WITH_WEEKDAY)}var s=n.filter((function(e){return"line"===e.name}));return(0,o.jsxs)("div",{className:C().tooltipContainer,children:[(0,o.jsx)("p",{className:C().tooltipLabel,children:u}),(0,o.jsx)("ul",{children:s.map((function(e,t){var n=e.value,r=e.payload,a=e.color,i=e.unit;return(0,o.jsxs)("li",{className:C().tooltipValue,children:[(0,o.jsx)("span",{className:C().tooltipValueDot,style:{color:a}}),j(n,r,i)]},t)}))})]})}return null},I=function(e){var t=e.start,n=e.end,r=e.graphData,a=r.timeseries,i=r.interval,u=r.layer,l=(0,f.useMemo)((function(){return null===a||void 0===a?void 0:a.map((function(e){var t=e.date,n=e.min,r=e.max,a=n.map((function(e,t){return[e,r[t]]})),o=n.map((function(e,t){return(e+r[t])/2}));return{date:new Date(t).getTime(),range:a,avg:o}})).filter((function(e){return!isNaN(e.avg[0])}))}),[a]);if(!l)return null;var c=l.length?(0,_.min)(l.flatMap((function(e){return e.range[0][0]}))):0,s=l.length?(0,_.max)(l.flatMap((function(e){return e.range[0][1]}))):0,d=(s-c)/8,b=[Math.max(0,Math.floor(c-d)),Math.ceil(s+d)];return(0,o.jsx)("div",{className:C().graph,children:(0,o.jsx)(v.h,{width:"100%",height:240,children:(0,o.jsxs)(m.c,{data:l,margin:{top:15,right:20,left:-20,bottom:-10},children:[(0,o.jsx)(g.q,{vertical:!1}),(0,o.jsx)(h.K,{domain:[new Date(t).getTime(),new Date(n).getTime()],dataKey:"date",interval:"preserveStartEnd",tickFormatter:function(e){return function(e,t){var n=M.ou.fromMillis(e).toUTC().setLocale(S.MV),r="";switch(t){case"month":r=n.toFormat("LLL y");break;case"hour":r=n.toLocaleString(M.ou.DATETIME_MED);break;default:r=n.toLocaleString(M.ou.DATE_MED_WITH_WEEKDAY)}return r}(e,i)},axisLine:0===b[0],type:"number"}),(0,o.jsx)(p.B,{scale:"linear",domain:b,interval:"preserveEnd",tickFormatter:Z,axisLine:!1,tickLine:!1,tickCount:4}),(0,o.jsx)(y.u,{content:(0,o.jsx)(D,{timeChunkInterval:i})}),(0,o.jsx)(x.x,{name:"line",type:"monotone",dataKey:function(e){return e.avg[0]},unit:u.legend.unit,dot:!1,isAnimationActive:!1,stroke:u.legend.color,strokeWidth:2},"".concat(u.id,"-line")),(0,o.jsx)(E.u,{name:"area",type:"monotone",dataKey:function(e){return e.range[0]},activeDot:!1,fill:u.legend.color,stroke:"none",fillOpacity:.2,isAnimationActive:!1},"".concat(u.id,"-area"))]})})})},A=n(52294),T=n(17339),L=n(53476),R=n(43859),N=n(10020),F=n(70865),V=n(96670),O=n(50930),z=n(71206),W=n(67601),U=function(e,t){return e.map((function(e){var n=e.frame,a=(0,r.Z)(e,["frame"]),o=(0,W.aP)(n,t);return{values:Object.values(a),date:o.toISOString()}}))},q=n(30206),G=n(15143);function K(e,t){return null===e||void 0===e?void 0:e.coordinates[0].every((function(e){return(0,G.Z)(e,t)}))}var P=(0,L.atom)({key:"mapTimeseriesState",default:void 0}),X=function(e){var t=(0,i.useRouter)().query.areaId,n=(0,a.Z)((0,A.xz)(),1)[0],r=n.start,o=n.end,u=(0,a.Z)((0,L.useRecoilState)(P),2),l=u[0],c=u[1],s=(0,N.N)(),d=(0,q.IG)(s),v=(0,f.useMemo)((function(){if(!e)return null;var t=(0,T.Z)(e.geometry,{tolerance:.1});return t.bbox=(0,R.Z)(t),t}),[e]),m=(0,f.useCallback)((function(e,t){var n,r=e.map((function(e){return e.chunksFeatures.flatMap((function(e){var t=e.active,n=e.features;return t&&n?n:[]}))})),o=(n=t,r.map((function(e){return e.reduce((function(e,t){if(!(null===t||void 0===t?void 0:t.geometry))return e;if(!n)return e.contained.push(t),e;var r=(0,a.Z)(t.geometry.coordinates[0],3),o=(0,a.Z)(r[0],2),i=o[0],u=o[1],l=(0,a.Z)(r[1],1)[0],c=(0,a.Z)(r[2],2),s=(c[0],c[1]),d=[i,u,l,s],f=function(e,t){return!(t[0]<e[0])&&!(t[2]>e[2])&&!(t[1]<e[1])&&!(t[3]>e[3])}(null===n||void 0===n?void 0:n.bbox,d);if(f&&"MultiPolygon"===n.type?n.coordinates.some((function(e){return K(t.geometry,{type:"Polygon",coordinates:e})})):K(t.geometry,n))e.contained.push(t);else{var v={type:"Point",coordinates:[(i+l)/2,(u+s)/2]};(0,G.Z)(v,n)&&e.overlapping.push(t)}return e}),{contained:[],overlapping:[]})}))),i=function(e,t){var n=t.layersWithFeatures;return e.flatMap((function(e,t){var r,a,o=null===(r=n[t])||void 0===r?void 0:r.metadata;if(!o)return[];var i=o.numSublayers,u=(0,W._C)(o.timeChunks).quantizeOffset,l=o.timeChunks.interval,c=(0,z.E8)(e.contained||[],i,u,o.aggregationOperation).values,s=U(c,l),d=(0,O.Z)(e.contained||[]).concat((0,O.Z)(e.overlapping||[])),f=(0,z.E8)(d,i,u,o.aggregationOperation).values,v=U(f,l).map((function(e){var t,n=e.values,r=e.date,a=null===(t=s.find((function(e){return e.date===r})))||void 0===t?void 0:t.values;return{date:r,min:a?(0,z.NX)(a):new Array(n.length).fill(0),max:(0,z.NX)(n)}})),m=null===(a=o.sublayers)||void 0===a?void 0:a[0];return{timeseries:v,interval:l,layer:{id:m.id,legend:m.legend}}}))}(o,{layersWithFeatures:e});c(i)}),[c]);(0,f.useEffect)((function(){c(void 0)}),[t]),(0,f.useEffect)((function(){(0,q.Eg)(d)&&m(d,v)}),[d,v]);var g=(0,f.useMemo)((function(){if(r&&o&&l)return function(e,t,n){var r=M.ou.fromISO(t),a=M.ou.fromISO(n);return null===e||void 0===e?void 0:e.map((function(e){return(0,V.Z)((0,F.Z)({},e),{timeseries:null===e||void 0===e?void 0:e.timeseries.filter((function(e){var t=M.ou.fromISO(e.date);return t>=r&&t<a}))})}))}(l,r,o)}),[o,r,l]);return{loading:!l&&!(0,q.Eg)(d),error:(0,q.LR)(d),layersTimeseriesFiltered:g}},B=n(35887),H=n(73591),Y=n(70272),$=n.n(Y),J=function(){var e=(0,i.useRouter)().query,t=(e.layerId,e.areaId,(0,r.Z)(e,["layerId","areaId"])),n=function(){var e,t,n,r=(0,i.useRouter)().query,a=r.areaId,o=r.layerId,u=(0,N.xO)().find((function(e){return e.id===o})),l=(0,f.useMemo)((function(){return[(0,V.Z)((0,F.Z)({},u),{filter:["==","id",a]})]}),[a,u]),c=(0,q.IG)(l),s=(0,f.useMemo)((function(){var e,t,n;return null===c||void 0===c||null===(e=c[0])||void 0===e||null===(t=e.features)||void 0===t?void 0:t.reduce((function(e,t){return(0,B.Z)(e,t)}),null===c||void 0===c||null===(n=c[0])||void 0===n?void 0:n.features[0])}),[c]),d=null===s||void 0===s||null===(n=s.properties)||void 0===n?void 0:n[null===u||void 0===u||null===(e=u.dataset)||void 0===e||null===(t=e.configuration)||void 0===t?void 0:t.polygonId],v=null===s||void 0===s?void 0:s.geometry,m=(0,H.ez)(),g=(0,f.useMemo)((function(){return v?(0,R.Z)(v):null}),[v]);return(0,f.useEffect)((function(){g&&m(g,{padding:30})}),[g,m]),{areaName:d,areaFeature:s}}(),u=n.areaName,c=n.areaFeature,v=X(c),m=v.layersTimeseriesFiltered,g=v.loading,h=(0,a.Z)((0,A.xz)(),1)[0],p=h.start,y=h.end;return(0,o.jsxs)("div",{className:s()("scrollContainer",$().container),children:[(0,o.jsxs)("div",{className:$().header,children:[(0,o.jsxs)("h2",{children:["Analysis ",u?"- ".concat(u):""]}),(0,o.jsx)(l(),{href:{pathname:"/",query:t},children:(0,o.jsx)(d.hU,{icon:"close"})})]}),(null===m||void 0===m?void 0:m.length)>0&&(0,o.jsx)("ul",{className:$().graphsContainer,children:m.map((function(e){return(0,o.jsxs)("li",{children:[(0,o.jsx)("label",{children:e.layer.id}),g?(0,o.jsx)(d.$j,{}):(0,o.jsx)(I,{start:p,end:y,graphData:e},e.layer.id)]})}))})]})}},73591:function(e,t,n){"use strict";n.d(t,{OC:function(){return f},R9:function(){return v},ez:function(){return m}});var r=n(66383),a=n(2784),o=n(53476),i=n(61636),u=n(55988),l=n(43807),c=n(57256),s=n(42055),d=(0,o.atom)({key:"mapBounds",default:void 0});function f(e,t){return!(!e||!t)&&(e.north===t.north&&e.south===t.south&&e.west===t.west&&e.east===t.east)}function v(){var e=(0,u.Z)(),t=(0,l.bS)(),n=(0,r.Z)((0,o.useRecoilState)(d),2),i=n[0],s=n[1],f=(0,c.Sj)().viewport,v=(0,a.useCallback)((function(){if(e){var t=e.getBounds();t&&s({north:(n=t).getNorth(),south:n.getSouth(),west:n.getWest(),east:n.getEast()})}var n}),[e,s]);return(0,a.useEffect)((function(){f&&v()}),[f,v]),(0,a.useEffect)((function(){t&&v()}),[t,v]),i}function m(){var e=(0,u.Z)(),t=(0,c.Sj)().setMapCoordinates,n=(0,a.useCallback)((function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.mapWidth,o=r.mapHeight,u=r.padding,l=void 0===u?60:u,c=a||(e?parseInt(e.getCanvas().style.width):window.innerWidth/2),d=o||(e?parseInt(e.getCanvas().style.height):window.innerHeight-s.Ry),f=(0,i.Xg)({bounds:[[n[0],n[1]],[n[2],n[3]]],width:c,height:d,padding:l}),v=f.latitude,m=f.longitude,g=f.zoom;t({latitude:v,longitude:m,zoom:Math.max(0,g)})}),[e,t]);return n}},57256:function(e,t,n){"use strict";n.d(t,{C:function(){return h},Sj:function(){return m},zg:function(){return g}});var r=n(70865),a=n(66383),o=n(2784),i=n(53476),u=n(68578),l=n(19102),c=n(85242),s=n(42055),d=(0,l.Ry)({latitude:(0,l.Rx)(),longitude:(0,l.Rx)(),zoom:(0,l.Rx)()}),f=(0,i.atom)({key:"viewport",default:s.Ps,effects:[(0,u.urlSyncEffect)({refine:d,history:"replace"})]}),v=(0,i.atom)({key:"localViewport",default:f,effects:[]});function m(){var e=(0,a.Z)((0,i.useRecoilState)(v),2),t=e[0],n=e[1],u=(0,o.useCallback)((function(e){n((function(t){return(0,r.Z)({},t,e)}))}),[]);return{viewport:t,onViewportChange:(0,o.useCallback)((function(e){var t=e.viewState,r=t.latitude,a=t.longitude,o=t.zoom;r&&a&&o&&n({latitude:r,longitude:a,zoom:o})}),[]),setMapCoordinates:u}}var g=function(){var e=(0,i.useRecoilValue)(v),t=(0,i.useSetRecoilState)(f),n=(0,c.Nr)(e,s.rF);(0,o.useEffect)((function(){t(n)}),[n,t])},h=function(){return(0,i.useRecoilValue)(f)}},52294:function(e,t,n){"use strict";n.d(t,{CI:function(){return g},kx:function(){return h},xz:function(){return m}});var r=n(2784),a=n(53476),o=n(68578),i=n(19102),u=n(85242),l=n(42055),c={start:l.gZ.start,end:l.gZ.end},s=(0,i.Ry)({start:(0,i.Z_)(),end:(0,i.Z_)()}),d=(0,a.atom)({key:"timerange",default:c,effects:[(0,o.urlSyncEffect)({refine:s,history:"replace",syncDefault:!0})]}),f=(0,a.atom)({key:"localTimerange",default:d,effects:[]}),v=(0,a.atom)({key:"highlightedTimerange",default:null,effects:[]}),m=function(){return(0,a.useRecoilState)(f)},g=function(){return(0,a.useRecoilState)(v)},h=function(){var e=(0,a.useRecoilValue)(f),t=(0,a.useSetRecoilState)(d),n=(0,u.Nr)(e,l.rF);(0,r.useEffect)((function(){t(n)}),[n,t])}},63898:function(e,t,n){"use strict";n.d(t,{RR:function(){return u},X_:function(){return l}});var r=n(70865),a=n(26297),o=n(99490),i=n(42055),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.format,r=void 0===n?o.ou.DATE_MED:n,a=t.locale,u=void 0===a?i.MV:a,l=t.showUTCLabel,c=void 0!==l&&l,s="number"===typeof e?o.ou.fromMillis(e):o.ou.fromISO(e);return"".concat(s.toUTC().setLocale(u).toLocaleString(r)).concat(r===o.ou.DATETIME_MED||c?" ".concat("UTC"):"")},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,o=void 0===n?i.MV:n,u=(0,a.Z)(t,["locale"]),l="string"===e?parseFloat(e):e;try{return new Intl.NumberFormat(o,(0,r.Z)({maximumFractionDigits:e<10?2:0},u)).format(l)}catch(c){return console.warn(c),e}}},70272:function(e){e.exports={container:"Analysis_container__qdvB5",header:"Analysis_header__23OSn",graphsContainer:"Analysis_graphsContainer__UWePV"}},34054:function(e){e.exports={graph:"AnalysisEvolutionGraph_graph__qrdIo",tooltipContainer:"AnalysisEvolutionGraph_tooltipContainer__e5f3l",tooltipRow:"AnalysisEvolutionGraph_tooltipRow__bIUUS",tooltipLabel:"AnalysisEvolutionGraph_tooltipLabel__fb0bh",tooltipValueDot:"AnalysisEvolutionGraph_tooltipValueDot__AiSAV"}}}]);