(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{84067:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return le}});var o=n(98788),i=n(94776),a=n.n(i),r=n(52322),l=n(10297),u=n(2784),s=n(15182),d=n.n(s),c=n(44017),f=n(85242),v=n(47842),p=n(72779),m=n.n(p),g=n(42192),h=n(67601),_=n(57256),b=n(73591),x=n(10020),y=n(80209),C=n.n(y),w=function(e){var t,n=e.mapLoading,o=void 0!==n&&n,i=(0,x.PS)(),a=i.layersConfig,l=i.updateLayer,s=(0,_.Sj)(),d=s.viewport,c=s.setMapCoordinates,p=d.latitude,y=d.longitude,w=d.zoom,S=(0,b.R9)(),k=(0,u.useMemo)((function(){return{latitude:p,longitude:y}}),[p,y]),M=(0,u.useMemo)((function(){return{bounds:S,center:k}}),[S,k]),j=(0,f.Nr)(M,16),Z=(0,u.useCallback)((function(){c({latitude:p,longitude:y,zoom:w+1})}),[p,y,c,w]),N=(0,u.useCallback)((function(){c({latitude:p,longitude:y,zoom:Math.max(1,w-1)})}),[p,y,c,w]),V=null===a||void 0===a?void 0:a.find((function(e){var t;return(null===(t=e.config)||void 0===t?void 0:t.type)===h.TF.Basemap})),P=null===V||void 0===V?void 0:V.config,T=null!==(t=null===P||void 0===P?void 0:P.basemap)&&void 0!==t?t:h.sc.Default;return(0,r.jsx)(u.Fragment,{children:(0,r.jsxs)("div",{className:C().mapControls,children:[(0,r.jsx)(g.e2,{className:C().miniglobe,size:60,viewportThickness:3,bounds:j.bounds,center:j.center}),(0,r.jsxs)("div",{className:m()("print-hidden",C().controlsNested),children:[(0,r.jsx)(g.hU,{icon:"plus",type:"map-tool",tooltip:"Zoom in",onClick:Z}),(0,r.jsx)(g.hU,{icon:"minus",type:"map-tool",tooltip:"Zoom out",onClick:N}),(0,r.jsx)(g.u,{content:T===h.sc.Default?"Switch to satellite basemap":"Switch to default basemap",placement:"left",children:(0,r.jsx)("button",{"aria-label":T===h.sc.Default?"Switch to satellite basemap":"Switch to default basemap",className:m()(C().basemapSwitcher,C()[T]),onClick:function(){l({id:null===V||void 0===V?void 0:V.id,config:{basemap:T===h.sc.Default?h.sc.Satellite:h.sc.Default}})}})}),(0,r.jsx)(g.hU,{type:"map-tool",tooltip:"Loading",loading:o,className:m()(C().loadingBtn,(0,v.Z)({},C().visible,o))})]})]})})},S=n(66383),k=n(36234),M=n(52294),j=n(75409),Z=n.n(j),N=function(){var e=(0,S.Z)((0,M.xz)(),1)[0],t=e.start,n=e.end;if(!t||!n)return null;var o=function(e,t){return(e&&t?new Date(t).getTime()-new Date(e).getTime():0)<=864e5?k.ou.DATETIME_MED:k.ou.DATE_MED}(t,n),i=void 0!==o.hour;return(0,r.jsx)("div",{className:Z().dateRange,children:"".concat(k.ou.fromISO(t).toUTC().toLocaleString(o)," ").concat(i?"UTC":""," - ").concat(k.ou.fromISO(n).toUTC().toLocaleString(o)," ").concat(i?"UTC":"")})},V=function(e){var t=e.center;return(0,r.jsxs)("div",{className:Z().info,children:[(0,r.jsxs)("div",{className:Z().flex,children:[(0,r.jsx)(l.jf,{maxWidth:100,unit:"metric"}),t&&(0,r.jsxs)("div",{className:m()("print-hidden",Z().mouseCoordinates),children:[t.latitude.toFixed(4)," ",t.longitude.toFixed(4)]})]}),(0,r.jsx)(N,{})]})},P=n(70865),T=n(96670),I=n(50930),O=n(71206),z=n(42055);var E=function(e){return e.map((function(e){return function(e){var t;switch(null===(t=e.dataset)||void 0===t?void 0:t.type){case"4wings":var n,o,i,a,r=e.config,l=e.dataset,u=[{id:e.id,colorRamp:(null===r||void 0===r?void 0:r.colorRamp)||"teal",visible:null===(a=null===r||void 0===r?void 0:r.visible)||void 0===a||a,breaks:(null===r||void 0===r?void 0:r.breaks)||[0,1,2,3,4,5,6,7,8,9],datasets:[l.id],legend:{label:null===l||void 0===l?void 0:l.name,unit:null===l||void 0===l?void 0:l.unit,color:r.color}}],s=!1!==(null===(n=e.config)||void 0===n?void 0:n.visible);return(0,P.Z)({id:e.id,type:h.TF.HeatmapAnimated,sublayers:u,maxZoom:r.maxZoom||8,mode:h.Mt.Single,dynamicBreaks:(null===r||void 0===r?void 0:r.dynamicBreaks)||!0,minVisibleValue:null===r||void 0===r?void 0:r.minVisibleValue,maxVisibleValue:null===r||void 0===r?void 0:r.maxVisibleValue,interactive:!0,aggregationOperation:(null===l||void 0===l||null===(o=l.configuration)||void 0===o?void 0:o.aggregationOperation)||O.YB.Avg,availableIntervals:null===l||void 0===l||null===(i=l.configuration)||void 0===i?void 0:i.intervals,visible:s,tilesAPI:"".concat(z.T5,"/4wings/tile/heatmap/{{z}}/{{x}}/{{y}}")},l.startDate&&{datasetsStart:l.startDate},l.endDate&&{datasetsEnd:l.endDate});case"context":var d=e.dataset;return{id:e.id,visible:e.config.visible,color:e.config.color,type:h.TF.Polygons,url:"".concat(z.T5,"/datasets/").concat(d.id,"/data"),attribution:d.source,metadata:{interactive:!0}};default:return(0,P.Z)({id:e.id},e.config)}}(e)}))},A=[h.ZA.Background,h.ZA.Basemap,h.ZA.BasemapForeground,h.ZA.BasemapFill,h.ZA.OutlinePolygonsBackground,h.ZA.Heatmap,h.ZA.OutlinePolygonsFill,h.ZA.OutlinePolygons,h.ZA.Default,h.ZA.OutlinePolygonsHighlighted],R=[function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,n=e.layers?(0,I.Z)(e.layers):[],o=n.sort((function(e,n){var o,i,a=(null===(o=e.metadata)||void 0===o?void 0:o.group)||h.ZA.Default,r=(null===(i=n.metadata)||void 0===i?void 0:i.group)||h.ZA.Default;return t.indexOf(a)-t.indexOf(r)}));return(0,T.Z)((0,P.Z)({},e),{layers:o})},h.Q3],D=function(){var e=(0,x.Xe)(),t=function(){var e=(0,_.Sj)().viewport,t=(0,S.Z)((0,M.xz)(),1)[0];return(0,u.useMemo)((function(){return{start:t.start,end:t.end,zoom:e.zoom}}),[t,e.zoom])}(),n=(0,u.useMemo)((function(){var t=e.filter((function(e){var t;return!(null===(t=e.dataset)||void 0===t?void 0:t.status)||"COMPLETED"===e.dataset.status}));return E(t)}),[e]);return(0,f.U0)(n,t,R)},F=n(43807),L=n(55988),B=n(30206),U=n(71413),q=n(93439),H=n(21883),W=n(80212),X=n.n(W);var K=function(e){var t,n,o=e.feature,i=(0,x.Xe)().find((function(e){return e.id===o.generatorId})),a=null===(n=null===i||void 0===i||null===(t=i.dataset)||void 0===t?void 0:t.configuration)||void 0===n?void 0:n.polygonId;return(0,r.jsx)("div",{className:X().popupSection,children:(0,r.jsx)("div",{className:X().row,children:(0,r.jsx)("span",{className:X().rowText,children:a?o.properties[a]:o.value})})})};var G=function(e){var t,n=e.event,o=e.closeButton,i=void 0!==o&&o,a=e.closeOnClick,u=void 0!==a&&a,s=e.className,d=void 0===s?"":s,c=e.onClose,f=e.anchor;return n&&n.latitude&&n.longitude&&(null===(t=n.features)||void 0===t?void 0:t.length)?(0,r.jsx)(l.GI,{latitude:n.latitude,longitude:n.longitude,closeButton:i,closeOnClick:u,onClose:c,className:m()(X().popup,d),anchor:f,focusAfterOpen:!1,maxWidth:"600px",children:n.features.map((function(e){return e.generatorType===h.TF.Polygons?(0,r.jsx)(K,{feature:e}):(0,r.jsx)("div",{className:X().popupSection,children:(0,r.jsx)("div",{className:X().row,children:(0,r.jsx)("span",{className:X().rowText,children:e.value})})},e.id)}))}):null},Y=n(28316),Q=n(1837),J=n(77252),$=n.n(J),ee=function(e){var t,n=e.legend;return n?(0,r.jsx)(g.py,{layer:n,className:$().legend,roundValues:n.category!==Q.OL.Environment,currentValueClassName:$().currentValue,labelComponent:(null===(t=n.label)||void 0===t?void 0:t.includes("\xb2"))?(0,r.jsx)(g.u,{content:"Approximated grid cell area at the Equator",children:(0,r.jsx)("span",{className:m()($().legendLabel,$().help),children:n.label})}):(0,r.jsx)("span",{className:$().legendLabel,children:n.label})}):null},te=function(e){var t=e.legends;return t&&t.length?(0,r.jsx)(u.Fragment,{children:null===t||void 0===t?void 0:t.map((function(e){var t=document.getElementById(e.id);return e&&t?(0,Y.createPortal)((0,r.jsx)(ee,{legend:e},e.id),t):null}))}):null},ne=n(12319),oe=n.n(ne),ie=function(e,t){var n={url:e};return"Tile"===t&&e.includes("globalfishingwatch")&&(n.headers={Authorization:"Bearer "+c.l_.getToken()}),n},ae=function(){var e=(0,o.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(401!==(null===(n=t.error)||void 0===n?void 0:n.status)||!(null===n||void 0===n?void 0:n.url.includes("globalfishingwatch"))){e.next=10;break}return e.prev=2,e.next=5,c.l_.refreshAPIToken();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.warn(e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),re={width:"100%",height:"100%"},le=function(){var e;(0,_.zg)(),(0,B.dN)(),function(){var e=(0,x.N)(),t=(0,b.R9)(),n=(0,x.PS)().updateLayer,o=(0,B.IG)(e),i=(0,B.Eg)(o),a=e.flatMap((function(e){var t=e.config;return"".concat(t.minVisibleValue,"-").concat(t.maxVisibleValue)})).join(","),r=(0,u.useCallback)((function(t,o){var i=null===t||void 0===t?void 0:t.flatMap((function(t){var n=t.chunksFeatures,i=t.layerId,a=t.metadata,r=((null===n||void 0===n?void 0:n[0])||{}).features;if(r&&r.length){var l,u=null===(l=e.find((function(e){return e.id===i})))||void 0===l?void 0:l.config,s=(0,q.wS)(r,o),d=(0,H.g3)(s,a).filter((function(e){var t=void 0===(null===u||void 0===u?void 0:u.minVisibleValue)||e>=(null===u||void 0===u?void 0:u.minVisibleValue),n=void 0===(null===u||void 0===u?void 0:u.maxVisibleValue)||e<=(null===u||void 0===u?void 0:u.maxVisibleValue);return t&&n}));if(d&&d.length){var c=d.length>1e3?(0,U.UP)(d,1e3,Math.random):d,f=(0,U.J6)(c),v=(0,U.IN)(c),p=f+2*v,m=f-2*v,g=c.filter((function(e){return e>=m&&e<=p})),_=Math.min(g.length,h.Am-1),b=(0,U.Pf)(g,_).map((function(e){var t=(0,S.Z)(e,1)[0];return parseFloat(t.toFixed(3))})),x=[];return b.forEach((function(e,t){if(t>1){var n=0===e||e<=(null===x||void 0===x?void 0:x[t-1])?x[t-1]+.01:e;x.push(n)}else x.push(e)})),{id:i,config:{breaks:x}}}return[]}return[]}));i&&n(i)}),[n,e]);(0,u.useEffect)((function(){i&&r(o,t)}),[i,a])}();var t=(0,x.N)(),n=(0,_.Sj)(),o=n.viewport,i=n.onViewportChange,a=D(),s=a.style,c=a.loading,v=(0,F.ZA)(),p=(0,L.Z)(),m=(0,B.hO)(),g=!v||c||!m,y=(0,f.Nr)(g,300),C=(0,u.useState)(),k=C[0],M=C[1],j=(0,f.X9)(M,void 0,p,null===s||void 0===s?void 0:s.metadata),Z=(0,u.useCallback)((function(){return M(void 0)}),[]),N=(0,f.qy)(null===s||void 0===s||null===(e=s.metadata)||void 0===e?void 0:e.interactiveLayerIds),P=(0,f.Uh)(s,t,k);return(0,r.jsxs)("div",{className:oe().container,children:[(0,r.jsx)(w,{mapLoading:y}),s&&(0,r.jsxs)(l.D5,{id:"map",style:re,mapLib:d(),latitude:o.latitude,longitude:o.longitude,zoom:o.zoom,mapStyle:s,onMove:i,onMouseMove:j,onMouseOut:Z,interactiveLayerIds:N,transformRequest:ie,onError:ae,children:[k&&(0,r.jsx)(G,{event:k}),P&&(0,r.jsx)(te,{legends:P}),(0,r.jsx)(V,{center:k})]})]})}},73591:function(e,t,n){"use strict";n.d(t,{OC:function(){return f},R9:function(){return v},ez:function(){return p}});var o=n(66383),i=n(2784),a=n(53476),r=n(61636),l=n(55988),u=n(43807),s=n(57256),d=n(42055),c=(0,a.atom)({key:"mapBounds",default:void 0});function f(e,t){return!(!e||!t)&&(e.north===t.north&&e.south===t.south&&e.west===t.west&&e.east===t.east)}function v(){var e=(0,l.Z)(),t=(0,u.bS)(),n=(0,o.Z)((0,a.useRecoilState)(c),2),r=n[0],d=n[1],f=(0,s.Sj)().viewport,v=(0,i.useCallback)((function(){if(e){var t=e.getBounds();t&&d({north:(n=t).getNorth(),south:n.getSouth(),west:n.getWest(),east:n.getEast()})}var n}),[e,d]);return(0,i.useEffect)((function(){f&&v()}),[f,v]),(0,i.useEffect)((function(){t&&v()}),[t,v]),r}function p(){var e=(0,l.Z)(),t=(0,s.Sj)().setMapCoordinates,n=(0,i.useCallback)((function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.mapWidth,a=o.mapHeight,l=o.padding,u=void 0===l?60:l,s=i||(e?parseInt(e.getCanvas().style.width):window.innerWidth/2),c=a||(e?parseInt(e.getCanvas().style.height):window.innerHeight-d.Ry),f=(0,r.Xg)({bounds:[[n[0],n[1]],[n[2],n[3]]],width:s,height:c,padding:u}),v=f.latitude,p=f.longitude,m=f.zoom;t({latitude:v,longitude:p,zoom:Math.max(0,m)})}),[e,t]);return n}},57256:function(e,t,n){"use strict";n.d(t,{C:function(){return g},Sj:function(){return p},zg:function(){return m}});var o=n(70865),i=n(66383),a=n(2784),r=n(53476),l=n(68578),u=n(19102),s=n(85242),d=n(42055),c=(0,u.Ry)({latitude:(0,u.Rx)(),longitude:(0,u.Rx)(),zoom:(0,u.Rx)()}),f=(0,r.atom)({key:"viewport",default:d.Ps,effects:[(0,l.urlSyncEffect)({refine:c,history:"replace"})]}),v=(0,r.atom)({key:"localViewport",default:f,effects:[]});function p(){var e=(0,i.Z)((0,r.useRecoilState)(v),2),t=e[0],n=e[1],l=(0,a.useCallback)((function(e){n((function(t){return(0,o.Z)({},t,e)}))}),[]);return{viewport:t,onViewportChange:(0,a.useCallback)((function(e){var t=e.viewState,o=t.latitude,i=t.longitude,a=t.zoom;o&&i&&a&&n({latitude:o,longitude:i,zoom:a})}),[]),setMapCoordinates:l}}var m=function(){var e=(0,r.useRecoilValue)(v),t=(0,r.useSetRecoilState)(f),n=(0,s.Nr)(e,d.rF);(0,a.useEffect)((function(){t(n)}),[n,t])},g=function(){return(0,r.useRecoilValue)(f)}},52294:function(e,t,n){"use strict";n.d(t,{CI:function(){return m},kx:function(){return g},xz:function(){return p}});var o=n(2784),i=n(53476),a=n(68578),r=n(19102),l=n(85242),u=n(42055),s={start:u.gZ.start,end:u.gZ.end},d=(0,r.Ry)({start:(0,r.Z_)(),end:(0,r.Z_)()}),c=(0,i.atom)({key:"timerange",default:s,effects:[(0,a.urlSyncEffect)({refine:d,history:"replace",syncDefault:!0})]}),f=(0,i.atom)({key:"localTimerange",default:c,effects:[]}),v=(0,i.atom)({key:"highlightedTimerange",default:null,effects:[]}),p=function(){return(0,i.useRecoilState)(f)},m=function(){return(0,i.useRecoilState)(v)},g=function(){var e=(0,i.useRecoilValue)(f),t=(0,i.useSetRecoilState)(c),n=(0,l.Nr)(e,u.rF);(0,o.useEffect)((function(){t(n)}),[n,t])}},21883:function(e,t,n){"use strict";n.d(t,{g3:function(){return a},hr:function(){return f}});var o=n(71206),i=n(67601),a=function(e,t){var n=t.timeChunks,a=null===n||void 0===n?void 0:n.activeChunkFrame,r=(0,i._C)(n);return n.chunks.map((function(i){return e.flatMap((function(e){var i=e.properties;return((0,o.so)({rawValues:i.rawValues,frame:a,delta:Math.max(1,n.deltaInIntervalUnits),quantizeOffset:r.quantizeOffset,sublayerCount:null===t||void 0===t?void 0:t.numSublayers,aggregationOperation:null===t||void 0===t?void 0:t.aggregationOperation,sublayerCombinationMode:null===t||void 0===t?void 0:t.sublayerCombinationMode,multiplier:null===t||void 0===t?void 0:t.multiplier})||[]).flatMap((function(e){return isNaN(e)||0===e||null===e?[]:e}))}))})).flatMap((function(e){return e})).sort((function(e,t){return e-t}))},r=n(47842),l=n(70865),u=n(96670),s=n(66383),d=n(36234),c=n(76635),f=function(e){return(0,c.uniqBy)(e,"sourceId").map((function(e){var t=e.chunksFeatures,n=e.metadata,a=e.state;if(!a.loaded||a.error||!t||!n)return[];var c=function(e){var t=e.chunksFeatures,n=e.numSublayers,a=e.interval,c=e.visibleSublayers,f=e.aggregationOperation,v=e.multiplier,p=null===t||void 0===t?void 0:t.flatMap((function(e){var t=e.features,p=e.quantizeOffset;if((null===t||void 0===t?void 0:t.length)>0){var m=(0,o.E8)(t,n,p,f).values.map((function(e){var t=Object.fromEntries(Object.entries(e).map((function(e){var t=(0,s.Z)(e,2),n=t[0],i=t[1],a="frame"===n||!0===c[parseInt(n)]?i:0;return[n,(0,o.KN)(a,{multiplier:v})]})));return(0,u.Z)((0,l.Z)({},t),{date:(0,i.aP)(e.frame,a).getTime()})}));if(f===o.YB.Avg){var g=m[m.length-1],h=d.ou.fromMillis(g.date),_="10days"===a?{day:10}:(0,r.Z)({},a,1),b=d.ou.fromMillis(g.date).plus(_).diff(h).milliseconds;return m.concat((0,u.Z)((0,l.Z)({},g),{frame:g.frame+1,date:g.date+b}))}return m}return[]}));return p}({chunksFeatures:t,interval:n.timeChunks.interval,numSublayers:n.numSublayers,visibleSublayers:n.visibleSublayers,aggregationOperation:n.aggregationOperation,multiplier:n.multiplier});return c}))[0]}},12319:function(e){e.exports={container:"Map_container__XXq7E"}},80209:function(e){e.exports={mapControls:"MapControls_mapControls__bkUKz",controlsNested:"MapControls_controlsNested__dnESI",basemapSwitcher:"MapControls_basemapSwitcher__a7ZrS",basemap_default:"MapControls_basemap_default___Wnk3",satellite:"MapControls_satellite__0encH",loadingBtn:"MapControls_loadingBtn__9rHkK",visible:"MapControls_visible__d_zPg"}},75409:function(e){e.exports={info:"MapInfo_info__R7VSN",flex:"MapInfo_flex__NWlHz",mouseCoordinates:"MapInfo_mouseCoordinates__91WgY",dateRange:"MapInfo_dateRange__fNKKS"}},77252:function(e){e.exports={legend:"MapLegends_legend__OchZf",currentValue:"MapLegends_currentValue__GFiGf",legendLabel:"MapLegends_legendLabel__VkRUC",help:"MapLegends_help__Npdnz",legendContainer:"MapLegends_legendContainer__Ae9yf"}},80212:function(e){e.exports={popup:"Popup_popup__ILyqM",popupSection:"Popup_popupSection__qINk_",popupSectionContent:"Popup_popupSectionContent__k7K_M",popupSectionTitle:"Popup_popupSectionTitle__Tt9T2",layerIcon:"Popup_layerIcon__vO2d2",rowContainer:"Popup_rowContainer__MmPPq",row:"Popup_row__k0vYE",list:"Popup_list__23dup",strong:"Popup_strong__1RCzD",rowColum:"Popup_rowColum__uyXvH",rowTitle:"Popup_rowTitle__qinmb",rowText:"Popup_rowText__elWAD",rowActions:"Popup_rowActions__UvQOW",secondary:"Popup_secondary__6H85s",flex:"Popup_flex__jhqV7",hover:"Popup_hover__rmeFD"}}}]);